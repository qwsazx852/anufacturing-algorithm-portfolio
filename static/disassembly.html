<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Objective Selective Disassembly</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0b1120;
            background-image:
                radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.1) 0px, transparent 50%);
            color: #f8fafc;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .input-field {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            width: 100%;
        }
    </style>
</head>

<body class="min-h-screen p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Breadcrumb / Back -->
        <a href="/" class="text-sky-400 hover:text-sky-300 mb-8 inline-block">&larr; Back to Portfolio</a>

        <header class="mb-12">
            <h1
                class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-400 mb-4">
                Selective Disassembly Planning
            </h1>
            <p class="text-xl text-slate-400">
                Optimizing the trade-off between <span class="text-green-400">Profit Maximization</span> and <span
                    class="text-teal-400">Carbon Footprint Minimization</span>.
            </p>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="glass-panel p-6 rounded-2xl border-l-4 border-yellow-500">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-1">Champion Algorithm</h3>
                <p class="text-3xl font-bold text-slate-100">PSO + PPX Hybrid</p>
                <p class="text-sm text-yellow-500 mt-2">Highest HV Score: 0.9460</p>
            </div>

            <div class="glass-panel p-6 rounded-2xl border-l-4 border-purple-500">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-1">NSGA-II Performance</h3>
                <p class="text-3xl font-bold text-slate-100">Robust & Stable</p>
                <p class="text-sm text-purple-400 mt-2">Legacy: 0.9300 | True: 0.9330</p>
            </div>

            <div class="glass-panel p-6 rounded-2xl border-l-4 border-sky-500">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-1">Optimization Goal</h3>
                <p class="text-3xl font-bold text-slate-100">Pareto Frontier</p>
                <p class="text-sm text-sky-400 mt-2">Finding Non-Dominated Solutions</p>
            </div>
        </div>

        <!-- Interactive Demo Section -->
        <section class="mb-20">
            <h2 class="text-2xl font-bold text-slate-200 mb-6 flex items-center">
                <span class="mr-3 text-2xl">ðŸŽ®</span> Interactive Demo
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Controls -->
                <div class="glass-panel p-6 rounded-2xl h-fit">
                    <h3 class="font-bold text-lg mb-4 text-sky-400">Configuration</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Algorithm</label>
                            <select id="algoSelect" class="input-field">
                                <option value="compare">Compare All (6 Algos)</option>
                                <option value="pso_ppx">PSO + PPX (Champion)</option>
                                <option value="nsga2">NSGA-II (True)</option>
                                <option value="nsga2_legacy">NSGA-II (Legacy)</option>
                                <option value="kg">K&G (Scalarized)</option>
                                <option value="npso">NPSO (Scalarized)</option>
                                <option value="block_ga">Block-Based GA</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Population Size</label>
                            <input type="number" id="popSize" value="50" class="input-field">
                        </div>

                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Generations</label>
                            <input type="number" id="generations" value="50" class="input-field">
                        </div>

                        <button onclick="runOptimization()" id="runBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3 px-4 rounded-xl transition duration-300 transform hover:scale-105 shadow-lg">
                            Start Optimization
                        </button>
                    </div>
                </div>

                <!-- Live Charts -->
                <div class="lg:col-span-3 space-y-6">
                    <!-- Convergence Chart -->
                    <div class="glass-panel p-4 rounded-2xl">
                        <h4 class="text-sm text-slate-400 mb-2 text-center">Real-time Convergence</h4>
                        <div class="h-64">
                            <canvas id="convergenceChart"></canvas>
                        </div>
                    </div>

                    <!-- Pareto Chart -->
                    <div class="glass-panel p-4 rounded-2xl">
                        <h4 class="text-sm text-slate-400 mb-2 text-center">Pareto Frontier</h4>
                        <div class="h-64">
                            <canvas id="paretoChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Static Visuals -->
        <div class="space-y-12">

            <!-- Section 1: Hypervolume Convergence -->
            <section>
                <h2 class="text-2xl font-bold text-slate-200 mb-6 flex items-center">
                    <span class="mr-3 text-2xl">ðŸ“ˆ</span> Full Benchmark (Pre-computed)
                </h2>
                <div class="glass-panel p-4 rounded-3xl">
                    <img src="/static/comparison_hypervolume.png" alt="Hypervolume Convergence"
                        class="w-full rounded-2xl hover:scale-[1.01] transition duration-500 md:h-[500px] object-cover object-center">
                    <p class="mt-4 text-center text-slate-400 text-sm">Comparison of convergence rates.
                        <strong>PSO+PPX</strong> (Cyan) leads with the fastest and highest convergence.
                    </p>
                </div>
            </section>

            <!-- Section 2: Pareto Frontier -->
            <section>
                <h2 class="text-2xl font-bold text-slate-200 mb-6 flex items-center">
                    <span class="mr-3 text-2xl">ðŸ§©</span> Pareto Frontier Breakdown
                </h2>
                <div class="glass-panel p-4 rounded-3xl">
                    <img src="/static/comparison_pareto_separated.png" alt="Pareto Frontier Separated"
                        class="w-full rounded-2xl hover:scale-[1.01] transition duration-500">
                    <p class="mt-4 text-center text-slate-400 text-sm">Detailed view of the non-dominated solutions
                        found by each algorithm.</p>
                </div>
            </section>

        </div>

        <footer class="mt-20 text-center text-slate-600">
            <p>Project Portfolio &copy; 2025. Powered by Python, FastAPI & Tailwind CSS.</p>
        </footer>

    </div>

    <script>
        // Check Chart.js
        if (typeof Chart === 'undefined') {
            console.error("Chart.js failed to load!");
        }

        let convergenceChart = null;
        let paretoChart = null;

        function initCharts() {
            const ctx1 = document.getElementById('convergenceChart').getContext('2d');
            convergenceChart = new Chart(ctx1, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: { display: true, title: { display: true, text: 'Generation' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { display: true, title: { display: true, text: 'Hypervolume' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: { legend: { labels: { color: 'white' } } }
                }
            });

            const ctx2 = document.getElementById('paretoChart').getContext('2d');
            paretoChart = new Chart(ctx2, {
                type: 'scatter',
                data: { datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 'Profit (Max)' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { title: { display: true, text: 'Carbon (Min)' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: { legend: { labels: { color: 'white' } } }
                }
            });
        }

        async function runOptimization() {
            const btn = document.getElementById('runBtn');
            const algo = document.getElementById('algoSelect').value;
            const popSize = parseInt(document.getElementById('popSize').value);
            const gens = parseInt(document.getElementById('generations').value);

            btn.disabled = true;
            btn.innerHTML = `<span class="animate-spin inline-block mr-2">ðŸ”„</span> Running...`;

            try {
                let endpoint = "";
                if (algo === 'compare') endpoint = "/disassembly/optimize/compare";
                else endpoint = `/disassembly/optimize/${algo}`;

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pop_size: popSize,
                        generations: gens,
                        crossover_rate: 0.8,
                        mutation_rate: 0.2,
                        neighborhood_start_gen: 20
                    })
                });

                const data = await response.json();
                updateCharts(data, algo, gens);

            } catch (error) {
                console.error("Error:", error);
                alert("Optimization Failed: " + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = "Start Optimization";
            }
        }

        function updateCharts(data, mode, gens) {
            const labels = Array.from({ length: gens }, (_, i) => i + 1);

            // Clean datasets
            let convDatasets = [];
            let paretoDatasets = [];

            const colors = {
                'NSGA-II (True)': '#a855f7', // Purple
                'NSGA-II (Legacy)': '#f97316', // Orange
                'PSO+PPX': '#06b6d4', // Cyan
                'K&G': '#22c55e', // Green
                'NPSO': '#ec4899', // Pink
                'Block-based GA': '#eab308' // Yellow
            };

            const processResult = (item) => {
                const name = item.algorithm || item.algo_name || mode;
                const color = colors[name] || '#3b82f6';

                // Convergence
                convDatasets.push({
                    label: name,
                    data: item.result.history,
                    borderColor: color,
                    tension: 0.1,
                    pointRadius: 0
                });

                // Pareto
                const points = item.result.pareto_front.map(p => ({ x: p[0], y: p[1] }));
                paretoDatasets.push({
                    label: name,
                    data: points,
                    backgroundColor: color,
                    pointRadius: 5
                });
            };

            if (mode === 'compare') {
                data.results.forEach(processResult);
            } else {
                processResult(data);
            }

            // Update Convergence
            convergenceChart.data.labels = labels;
            convergenceChart.data.datasets = convDatasets;
            convergenceChart.update();

            // Update Pareto
            // Add Utopia Point
            paretoDatasets.push({
                label: 'Utopia',
                data: [{ x: 350, y: 0.001 }],
                backgroundColor: '#eab308', // Yellow
                pointStyle: 'star',
                pointRadius: 10
            });
            paretoChart.data.datasets = paretoDatasets;
            paretoChart.update();
        }

        // Initialize
        initCharts();
    </script>
</body>

</html>