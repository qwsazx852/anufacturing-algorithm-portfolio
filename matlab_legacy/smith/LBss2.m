
function SS = LBss2(s,T1,T22); %計算適應值(f1利潤)smith


%%  new
f1R=0.95;%利潤設定範圍
f2R=0.85;%碳足跡設定範圍

% %% 拆裝時間 利潤計算
% s=[1 3 2 5 6 7 8 4 12 15 16 17 18 9 10 11 13 14];
% asb=[18];
% a=[];
% add=0;
% ans=[];
% Dc=[18	10	16	17	3	14	2	9	5	6	7	15	11	12	13	1	8	4];%liaison零件關係
% DC2=[0.9297	0.911	0.797	0.797	0.797	0.797	0.482	0.294	0.266	0.266	0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234];%liaison單一零件組拆裝成本
% gw=[0.015,0.005,0.003,0.008,0.0025,0.003,0.0013,0.006,0.002,0.003,0.002,0.009,0.0021,0.0012,0.0025,0.003,0.003,0.004];%各零件重量
% reuse=[2 5 7 9 13];% 重新使用
% recycle=[3  10  14 16 17 18];%回收
% Remanufacturing=[4 6 8 11 12];%重新加工
% c=7.2844;%拆裝總成本
% mc=[25     5     2    25    10     8     7    10     8     2     5    20     5     5     7     2     2     2];%各零件成本
% add=0;
% 
% SS=[];
% %%碳足跡
% reuse=[2 5 7 9 13];% 重新使用
% recycle=[3  10  14 16 17 18];%回收
% Remanufacturing=[4 6 8 11 12];%重新加工
% asb2=[1];
% Cs=0.509;%% 碳係數/s0.0001413889
% gw=[0.015,0.005,0.003,0.008,0.0025,0.003,0.0013,0.006,0.002,0.003,0.002,0.009,0.0021,0.0012,0.0025,0.003,0.003,0.004];%各零件重量
% cc=[0.310000000000000	0.310000000000000	0.430000000000000	0.430000000000000	0.120000000000000	0.430000000000000	0.120000000000000	0.310000000000000	0.430000000000000	0.430000000000000	0.310000000000000	0.310000000000000	0.120000000000000	0.310000000000000	0.310000000000000	0.310000000000000	0.310000000000000	0.430000000000000];

%% 吊扇
asb=[13];
a=[];
add=0;
ans=[];
Dc=[13 7 18 7 18 4 1 2 3 4 14 13 14 8 9 22 24 10 14 10 14 22 23 24 7 18  ];%liaison零件關係
DC2=[0.9297	0.911	0.797	0.797	0.797	0.797	0.482	0.294	0.266	0.266	0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234 0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234];%liaison單一零件組拆裝成本
gw=[0.161;0.026;0.081;0.0127;0.002;0.002;0.407;0.006;0.006;0.305;0.006;0.006;1.356;0.389;0.006;0.006;0.305;0.201;0.006;0.006;0.006;0.168;0.168;0.168;0.007;0.0061];%四種類  材料 重量
%各零件重量
reuse=[3 4 7 10 13 14 17 18 25];% 重新使用
recycle=[5 6 8 9 11 12 19 20 21];%回收
Remanufacturing=[15 16 22 23 24];%重新加工
t=[1 2 26];
c=141.133;%拆裝總成本
mc=[50,10,40,70,5,5,220,4,4,300,4,4,350,250,2,2,100,120,4,4,4,200,200,200,40,40]; %新零件成本00
add=0;
%% 碳足跡
asb2=[22];
Cs=0.509;%% 碳係數/s0.0001413889
gw=[0.161;0.026;0.081;0.0127;0.002;0.002;0.407;0.006;0.006;0.305;0.006;0.006;1.356;0.389;0.006;0.006;0.305;0.201;0.006;0.006;0.006;0.168;0.168;0.168;0.007;0.0061];%四種類  材料 重量
cc=[0.01932,0.01932,0.00972,0.01524,0.00086,0.00086,0.04884,0.00072,0.00072,0.03660,0.00072,0.00072,0.16272,0.04668,0.00258,0.00258,0.03660,0.02412,0.00072,0.00072,0.00072,0.05208,0.05208,0.05208,0.00840,0.00732];%沖壓 擠壓 機械加工

SS=[];

%% 印表機
% asb=[50];
% a=[];
% add=0;
% ans=[];
% Dc=[1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	51	52];%liaison零件關係
% DC2=[0.9297	0.911	0.797	0.797	0.797	0.797	0.482	0.294	0.266	0.266	0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234 0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234 0.9297	0.911	0.797	0.797	0.797	0.797	0.482	0.294	0.266	0.266	0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234 0.224	0.1727	0.1727	0.1727	0.1354	0.0234	0.0234	0.0234];
% gw=[0.5395;0.0210;0.0043;0.1560;0.1230;0.0530;0.0020;0.0120;0.0042;0.0900;0.0030; 0.0122;0.0132;0.0034;0.0225;0.2672;0.0031;0.0170;0.0005;0.0005;0.0030;0.0030;0.0001;0.0030;0.0030;0.0002;0.2697;0.0150;20.0350;0.0020;0.1540;0.0025;0.0025;0.0025;0.0025;0.0980;0.0030;0.0220;0.0900;0.0041;0.0041;0.0041;0.0041;0.0010;0.7110;0.1621;0.0813;0.0231;0.5897;0.5342;0.0893;0.0743];%四種類  材料 重量
% %各零件重量
% reuse=[1 4 5 6 7 8 9 10 11 14 16 17 18 23 24 25 26 27 29 31 32 33 34 35 36 37 39 45 47 48 49 50 51 52];% 重新使用
% recycle=[7 19 20 23 28 30 44];%回收
% Remanufacturing=[15 38 40 41 42 43 21 22 13 12 46];%重新加工
% c=195.5464;%拆裝總成本
% mc=[90,20,20,100,30,100,100,75,66,35,2,6,6,10,300,200,5,2,3,3,6,6,3,4,4,1,80,80,3,120,12,5,5,5,5,30,25,300,80,6,6,6,6,25,45,6,30,90,30,30,35,650]; %新零件成本00
% add=0;
% SS=[];
% %% 碳足跡
% asb2=[45];
% Cs=0.509;%% 碳係數/s0.0001413889
% gw=[0.5395;0.0210;0.0043;0.1560;0.1230;0.0530;0.0020;0.0120;0.0042;0.0900;0.0030; 0.0122;0.0132;0.0034;0.0225;0.2672;0.0031;0.0170;0.0005;0.0005;0.0030;0.0030;0.0001;0.0030;0.0030;0.0002;0.2697;0.0150;20.0350;0.0020;0.1540;0.0025;0.0025;0.0025;0.0025;0.0980;0.0030;0.0220;0.0900;0.0041;0.0041;0.0041;0.0041;0.0010;0.7110;0.1621;0.0813;0.0231;0.5897;0.5342;0.0893;0.0743];%四種類  材料 重量
% cc=[0.231985,0.009030,0.001849,0.067080,0.052890,0.022790,0.000860,0.005160,0.001806,0.003870,0.001290,0.005246,0.005676,0.001462,0.009675,0.114896,0.001333,0.00731,0.000215,0.000215,0.00129,0.00129,0.000043,0.00129,0.00129,0.000086,0.115971,0.00645,0.01505,0.00086,0.06622,0.001075,0.001075,0.001075,0.001075,0.04214,0.00129,0.00946,0.0387,0.001763,0.001763,0.001763,0.001763,0.00043,0.30573,0.069703,0.034959,0.009933,0.253571,0.229706,0.038399,0.031949];

%% STEP1選拆零件上下限
% limit=sum(gw).*CR;
% p=0;
% for i =1:length(s)
%     p=p+gw(s(i));
%     if p >=limit
%         rang=i;
%         break
%     end
% end
savea=[];
saveb=[];

for i =1:length(s)-1
    %% 選拆後利潤
%       for i =1:length(s)
    add=0;
%           RR=s(i,:);


    d1=s(1:i);
    d=s(i+1:end);


    %% 拆卸成本
    for j =1:length(Dc)
        a=find(d1==Dc(j));
        if a>=1
            add=add+DC2(j);
        end
    end

    for j =1:length(d1)
       %% 加工成本%% remanufact
        n=0;
        for j1 =1:length(Remanufacturing)
            a=find(d1==Remanufacturing(j1));
            if a>1
                n=n+1;
            end
        end
        add=add+1.5.*n;%%加工係數

    end
    %% 新零件成本
    new=sum(mc(d));
    add=add+new;

    %% 回收利益
    get=sum(gw(d)).*0.005;%%%%%%%%%%目前只算廢棄零件回收 5元/kg




    %% recycle
    % 拆解之碳足跡
    cf=sum(gw(d1)).*Cs;%%%%%%%%%目前只算拆解零件之碳足跡
    %% 購入零件之碳足跡
    cp=0;
    %% 再加工之碳足跡
    cm=0;
    for j =1:length(Remanufacturing)
        a=find(d1==Remanufacturing(j));
        if a>=1
            cm=cm+gw(d1(a)).*cc(d1(a));
        end
    end
    %% 再回收之碳足跡
    cy=0;






    %% 工具方向變換
    DC=48;
    [SS1,SSS,SS2] = LBss1(s,T1,T22);%右變換次數，中時間成碳係數,左時間
    DC=DC+SS1;
    timescore=(DC.*0.049)+5.0306;


    f1=1200-(add+timescore)+get;%釘書機:150,印表機:1800
    f2=cf+cp+cm+cy+SSS;
    savea=[savea;f1,f2];   
    saveb=[saveb,s(i)];
% end

end
f1limit=max(savea(:,1)).*f1R;%因求最大利潤需大於此數值
f2limit=max(savea(:,2)).*f2R;%因求最小碳足跡需小於此數值
avalible=find(savea(:,1)>f1limit);
avalible2=find(savea(:,2)<f2limit);
c = intersect(avalible,avalible2);
if length(c)>0
    savea=savea(c,:);
    saveb= saveb(c);
    SS=[SS, savea(find(savea(:,1)==max(savea(:,1))),:)];
    saveb(find(savea(:,1)==max(savea(:,1))));
else
    ll=randperm(length(savea),1);
    SS=[SS, savea(ll,:)];
    saveb(ll);
end
% ss=saveb(find(savea(:,1)==max(savea(:,1))));
% end