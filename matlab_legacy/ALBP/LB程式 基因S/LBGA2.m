clc
clear
tic
%% 參數控制
chromosome = 20; %染色體數量
crossover = 0.8; %交配率
mutation = 0.2; %突變率
s = 100; %迭代數
L1 = 0.6;
L2 = 0.4;
%% Yuan
% n=35;
% order=[1 2;1 3;2 4;2 5;3 5;3 6;4 7;5 8;6 9;7 11;7 12;8 12;8 13;9 14;10 14;10 15;10 16;11 17;11 18;12 19;13 19;13 20;14 21;15 21;16 21;17 30;18 23;19 23;20 24;21 25;22 25;26 30;23 27;24 27;24 28;24 29;25 29;27 31;28 32;29 32;30 33;31 33;32 34;33 35;34 35];
% Information=[8.45 7.56 9.63 5.76 6.63 7.32 9.69 12.67 4.26 4.62 2.31 4.26 10.03 4.97 6.21 3.11 5.41 8.32 9.34 7.91 6.31 9.15 8.05 10.78 9.27 6.43 10.87 13.02 8.71 7.23 5.26 6.65 6.34 5.26 9.02];
% GCT=33.5;
%%  BOWMAN
n = 8;  % 工作個數
order = [1 2;2 3;2 4;3 5;3 6;4 6;5 7;6 8];  %先後順序條件限制
Information = [11 17 9 5 8 12 10 3];  %各工作時間
GCT = 20; %Given Cycle Time
%% Buxey
% n=29;
% order = [1 25;1 3;7 9;7 12;7 25;2 6;2 26;25 29;3 4;4 5;5 13;5 8;13 17;17 20;20 23;23 24;23 28;28 29;6 8;8 11;8 16;11 17; 16 18;18 22;22 23;9 10;10 14;10 15;14 16;12 15;15 19;19 21;21 22;26 27;27 29];
% Information=[7 19 15 5 12 10 8 16 2 6 21 10 9 4 14 7 14 17 10 16 1 9 25 14 14 2 10 7 20];
% GCT=41;
%%  Kilbridge
% n = 45;  % 工作個數
% order = [2 4;2 8;11 13;12 13;12 37;1 7;1 3;4 6;6 10;8 10;8 14;13 14;7 14;13 15;7 9;3 5;5 9;37 43;14 29;14 30;14 31;14 32;14 25;14 17;15 16;15 18;15 23;15 24;25 26;17 26;17 27;27 33;16 19;18 19;19 20;19 33;23 33;24 33;26 38;27 28;28 38;20 21;21 22;22 28;33 34;33 36;33 35;34 38;36 38;38 40;35 40;10 41;29 41;30 41;31 41;32 41;39 41;40 41;9 41;41 42;42 44;42 45];  %先後順序條件限制
% Information = [9 9 10 10 17 17 13 13 20 20 10 11 6 22 11 19 12 3 7 4 55 14 27 29 26 6 5 24 4 5 7 4 15 3 7 9 4 7 5 4 21 12 6 5 5];  %各工作時間
% GCT = 138; %Given Cycle Time
%%  WEE-MAG
% n=75;
% % order=[1 3;1 4;1 6;1 2;1 5;1 7;3 24;3 13;4 8;4 14;4 16;6 13;6 9;6 10;6 11;2 15;5 15;5 12;13 22;16 21;16 26;9 24;9 20;10 18;15 20;15 17;15 23;12 19;24 25;21 33;18 26;18 30;20 27;17 30;25 28;25 34;25 33;25 30;33 41;26 41;26 31;26 32;27 29;27 35;27 36;31 37;31 39;32 44;32 45;35 42;35 38;36 40;36 43;39 51;42 47;40 46;43 48;43 50;47 49;47 52;47 53;47 50;46 51;46 48;49 59;49 61;49 62;52 56;52 57;53 58;50 62;50 54;50 55;50 60;59 64;59 66;58 65;62 67;55 63;66 68;68 69;68 70;68 71;68 72;68 73;68 74;68 75];
% order=[1,2;1,3;1,4;1,5;1,6;1,7;2,15;3,13;3,24;4,8;4,14;4,16;5,12;5,15;6,9;6,10;6,11;6,13;9,20;9,24;10,18;12,19;13,22;15,17;15,20;15,23;16,21;16,26;17,30;18,26;18,30;20,27;21,33;24,25;25,28;25,30;25,33;25,34;26,31;26,32;26,41;27,29;27,35;27,36;31,37;31,39;32,44;32,45;33,41;35,38;35,42;36,40;36,43;39,51;40,46;42,47;43,48;43,50;46,51;46,48;47,49;47,50;47,52;47,53;49,59;49,61;49,62;50,54;50,55;50,60;50,62;52,56;52,57;53,58;55,63;58,65;59,64;59,66;62,67;66,68;68,69;68,70;68,71;68,72;68,73;68,74;68,75];
% Information = [23 24 25 26 23 22 6 22 23 21 22 15 5 23 4 26 21 5 24 25 26 26 24 27 20 23 25 13 3 11 21 22 21 22 25 8 22 24 22 21 6 26 22 6 21 25 11 22 21 25 22 22 23 22 22 25 23 21 22 22 22 22 21 27 23 2 26 25 24 22 24 4 22 10 25];  %各工作時間
% GCT = 30;
%% Arcus2
% n=111;
% order=[1,2;2,3;3,4;4,5;4,6;4,7;4,8;4,9;4,10;5,39;6,39;7,83;8,71;9,32;10,11;10,12;11,13;11,14;11,15;11,16;11,17;11,18;11,19;11,20;11,21;12,13;12,14;12,15;12,16;12,17;12,18;12,19;12,20;12,21;13,71;14,22;14,23;14,24;14,25;15,26;16,27;17,28;18,29;19,30;20,91;21,111;22,31;22,83;23,32;23,33;24,69;24,70;25,34;26,82;27,35;28,36;29,37;30,38;31,39;32,41;33,111;34,42;35,43;36,44;36,91;37,45;37,91;38,46;38,91;39,40;40,111;41,69;41,70;42,47;43,48;43,49;44,50;45,51;46,52;47,54;47,55;47,56;47,57;47,58;47,59;47,60;48,53;49,91;50,111;51,111;52,111;53,111;54,69;54,70;55,61;55,62;55,63;56,63;56,64;57,65;57,91;58,66;58,91;59,67;59,91;60,68;60,91;61,69;61,70;62,71;63,111;64,72;65,111;66,111;67,111;68,111;69,77;69,78;70,73;71,91;72,74;73,75;74,76;75,77;75,78;75,79;76,80;76,81;76,82;77,83;78,84;79,85;80,86;80,91;81,87;81,91;82,111;83,91;84,88;84,89;84,91;85,111;86,111;87,90;88,105;89,105;90,111;91,92;91,93;91,94;92,95;93,95;94,95;95,96;95,97;95,98;95,99;95,100;95,104;96,101;97,102;98,103;99,111;100,111;101,105;102,106;102,107;103,107;103,108;104,111;105,111;106,109;107,111;108,110;109,111;110,111];
% Information=[1960,1715,735,1715,490,1225,169,2252,1225,2319,1715,980,735,2281,2750,77,89,51,364,405,3060,125,3429,43,3430,1960,29,27,15,121,1715,2127,1470,4037,68,62,42,364,4998,1470,2963,5689,68,18,10,81,5200,39,67,27,15,121,58,1715,125,4010,1470,1470,2303,1960,2205,4018,2744,2999,735,735,735,735,545,3386,3234,2205,2206,490,825,3528,3568,1200,618,1470,1715,735,1960,2889,618,490,735,490,921,326,5390,243,371,58,5059,1225,769,768,1670,1670,490,202,203,202,2744,162,324,162,121,162,91];
% GCT=6837;
%% Barholdi1
% n=148;
% order=[1,5;1,6;1,7;1,8;2,3;3,4;3,5;3,6;3,7;4,8;5,14;6,9;7,14;8,10;9,14;10,14;11,12;12,13;14,15;14,16;15,17;16,17;17,18;17,19;18,20;19,20;20,21;20,22;20,23;20,24;21,25;21,26;21,27;21,28;22,25;22,26;22,27;22,28;23,25;23,26;23,27;23,28;24,25;24,26;24,27;24,28;25,29;26,29;27,29;28,29;29,31;31,36;32,34;33,35;34,36;35,36;36,37;37,38;37,45;38,39;39,40;40,41;40,48;40,54;42,43;43,44;45,46;46,47;47,48;47,49;47,54;50,51;51,53;51,69;52,53;54,55;54,72;54,76;54,89;54,90;55,133;56,73;57,82;58,86;58,88;59,75;59,89;61,62;62,63;63,67;64,65;64,71;64,72;65,66;65,99;66,67;67,68;68,95;68,98;69,79;70,71;72,134;73,86;73,88;73,89;73,90;73,96;74,75;75,90;75,97;76,77;77,78;78,82;79,85;79,80;79,143;79,146;80,81;81,82;82,83;83,84;84,106;86,87;90,111;91,105;92,135;95,101;96,104;98,101;99,100;100,101;101,102;101,103;102,127;103,127;105,119;106,107;107,108;108,109;109,110;111,112;112,113;113,114;113,116;113,120;113,123;113,128;114,115;115,125;116,117;117,118;118,126;120,121;121,122;122,126;123,124;124,125;128,129;129,130;130,131;130,137;132,135;133,135;134,135;135,136;138,139;139,140;141,142;142,143;142,146;142,147;142,148;144,145;145,147;145,148];
% Information=[16,30,7,47,29,8,39,37,32,29,17,11,32,15,53,53,8,24,24,8,7,8,14,13,10,25,11,25,11,29,25,10,14,41,42,47,7,80,7,41,47,16,32,66,80,7,41,13,47,33,34,11,118,25,7,28,12,52,14,3,3,8,16,33,8,18,10,14,28,11,118,25,40,40,101,5,28,8,281,7,26,10,21,26,20,21,47,23,13,19,115,35,26,46,20,31,19,34,51,39,30,26,13,45,58,28,8,383,40,34,23,162,11,19,14,31,32,26,55,31,32,26,19,14,19,48,55,8,11,27,18,36,23,20,46,64,22,15,34,22,151,148,64,170,137,64,78,78];
% GCT=564;
%% Scholl
% n=297;
% order=[1,2;2,3;3,4;4,5;4,22;4,26;4,27;4,40;4,48;4,56;4,83;4,86;4,94;4,105;4,109;4,111;4,134;4,221;4,247;4,259;5,6;6,7;6,8;6,9;6,10;7,11;7,12;7,13;7,14;7,15;7,20;8,11;8,12;8,13;8,14;8,15;8,20;9,11;9,12;9,13;9,14;9,15;9,20;10,11;10,12;10,13;10,14;10,15;10,20;11,16;12,17;13,18;14,19;15,21;16,23;17,23;18,23;19,23;20,23;21,23;22,24;22,25;23,28;24,29;25,29;26,30;27,31;28,32;28,37;29,33;29,44;29,121;30,34;30,297;31,34;31,82;31,172;31,179;32,36;33,38;34,35;35,42;36,39;37,39;38,41;39,43;40,44;40,84;40,97;41,45;42,46;43,47;44,49;45,50;46,51;46,138;47,52;48,52;49,53;50,54;51,55;51,81;52,57;53,58;54,58;54,296;55,59;56,60;56,61;57,62;57,63;57,71;57,76;58,64;59,64;59,99;59,100;60,68;61,65;62,66;63,67;64,72;65,69;66,69;67,70;68,73;69,74;70,75;71,77;72,78;73,84;73,97;74,84;74,97;75,84;75,97;76,84;76,97;77,84;77,97;78,79;78,80;78,125;78,192;79,85;80,85;81,87;82,88;82,89;83,90;84,91;85,92;86,93;87,99;87,100;88,99;88,100;89,99;89,100;90,95;91,96;92,98;93,98;94,101;95,101;96,101;97,101;98,102;99,103;100,104;101,106;102,107;103,108;104,108;105,110;106,112;107,113;108,114;108,115;108,292;109,119;109,120;110,119;110,120;110,162;111,116;112,117;113,118;114,119;115,120;116,122;117,123;117,124;117,257;118,126;119,127;120,127;120,150;121,128;122,129;123,130;123,145;123,146;123,147;123,148;123,149;124,130;125,130;126,130;127,130;127,157;128,130;129,130;129,141;130,131;130,144;131,132;131,133;132,135;133,135;133,170;134,136;135,137;136,139;137,140;138,140;138,191;139,142;139,253;140,143;140,200;141,151;142,152;143,153;143,169;144,154;145,155;146,156;147,158;148,159;149,160;150,161;151,163;152,164;153,165;154,166;155,166;156,166;157,166;158,166;159,166;160,166;161,166;162,167;163,166;164,167;165,168;165,176;166,170;167,171;168,173;169,174;170,174;171,174;172,175;173,177;174,178;174,287;174,288;175,180;176,181;177,181;178,181;179,181;180,181;180,252;181,182;181,183;181,184;181,185;181,186;181,187;181,188;181,189;181,196;181,197;181,295;182,190;183,193;184,194;185,195;186,195;187,195;188,195;189,195;190,195;191,200;192,201;193,198;194,199;195,199;195,203;195,205;195,227;195,229;196,202;197,202;198,202;199,202;200,202;201,202;202,204;202,251;203,206;203,208;204,207;204,250;205,207;206,209;207,210;207,212;208,210;209,210;209,211;210,213;211,213;212,214;213,214;214,215;214,234;215,216;216,217;217,218;218,219;219,220;220,222;221,223;222,224;223,225;224,226;225,227;226,228;227,230;228,231;229,235;229,236;230,232;230,271;230,289;231,233;232,236;233,237;234,238;234,256;235,237;236,239;237,240;238,240;238,285;239,240;239,279;240,241;240,243;241,242;242,244;243,245;243,246;244,245;244,246;244,255;245,248;246,248;247,278;248,249;249,254;249,284;250,256;251,256;252,258;253,260;254,261;255,261;255,262;256,263;257,264;258,265;259,266;260,267;261,268;261,269;262,269;263,270;264,271;265,272;266,271;267,273;268,274;269,274;270,274;271,274;272,275;273,276;274,277;274,278;274,282;275,280;276,281;277,283;278,283;279,286;280,290;281,291;282,293;283,293;284,294;285,294;286,294;287,293;288,293;289,294;290,293;291,293;292,293];
% Information=[270,270,130,148,190,293,348,182,490,212,248,248,248,248,248,268,268,268,288,248,268,60,268,240,240,171,490,182,170,306,108,248,190,240,339,288,248,455,268,270,180,121,270,440,249,194,162,130,388,90,212,246,188,270,160,79,466,240,137,184,110,275,149,280,119,184,140,150,190,150,150,284,192,347,232,140,608,80,40,130,110,350,140,240,240,90,54,294,203,150,270,155,190,78,140,241,430,90,110,9,430,130,289,110,160,442,159,250,190,184,690,72,190,190,90,889,170,155,190,130,390,301,54,227,142,184,741,868,230,121,320,126,440,127,134,150,140,110,320,250,232,188,250,377,90,140,90,90,70,90,110,150,101,377,118,290,209,150,150,79,150,91,59,218,351,873,130,68,126,120,227,198,132,121,150,100,38,70,355,284,122,75,160,140,520,99,182,80,514,96,50,272,226,194,164,96,107,108,167,98,82,482,72,50,130,230,50,240,190,190,240,74,139,339,260,132,550,420,152,12,90,5,128,100,120,100,320,835,740,223,100,390,140,304,120,403,21,246,160,1019,34,120,68,910,302,778,101,1310,20,278,81,290,100,372,72,28,90,250,144,303,220,58,224,211,99,44,120,70,421,231,214,196,280,398,72,280,356,193,140,130,300,456,7,170,252,210,308,308,121,52,426,104,1386,527,968,1047,538];
% GCT=1991;
%% 程式撰寫處
a=[];
b=[];
D=[];
x=[];
y=[];
Or = LBbn(order,n);
for i=1:chromosome %隨機產生初始解
    RR = randperm(n);
    RR = LBrr1(Or,n,RR);
    SS = LBss1(n,GCT,Information,RR,L1,L2);
    a=[a;RR];
    b=[b SS];
end
for i1=1:s
    i1
    f=(1./b);
    cc=LBcc(f,chromosome);
    a=[a;a(cc,:)];
    b=[b b(cc)];
    [a,b] = LBa6(n,a,b,crossover,GCT,Information,chromosome,L1,L2);
    [a,b] = LBb5(n,a,b,Or,GCT,Information,mutation,L1,L2);
    B = b(b==min(b)); %當代最小
    D = [D B(1)];  %歷代最小
    
    f = min(D);
    if i1 == 1
        x=[x 0];
        y=[y f];
    else
        if y(end) ~= f
            x = [x i1];
            y = [y y(end)];
        end
    end
    y = [y f];
    x = [x i1];
    
end

f

plot(x,y,'LineWidth',2)
title('收斂圖')
xlabel('代數')
ylabel('適應值')

toc